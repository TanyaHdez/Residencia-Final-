<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicio</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="icon" href="/assets/logo.png" sizes="200x200 100x100" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css" />

    <style>
        body {
            display: flex;
        }

        .sidebar {
            width: 250px;
            height: 100vh;
            background: #343a40;
            color: white;
            position: fixed;
            top: 0;
            left: 0;
            padding-top: 20px;
            text-align: center;
        }

        .sidebar img {
            width: 50px;
            margin-bottom: 10px;
        }

        .sidebar h4 {
            margin-bottom: 20px;
            font-size: 20px;
        }

        .sidebar a {
            z-index: 100; 
            padding: 15px 10px;
            text-decoration: none;
            font-size: 18px;
            color: white;
            display: block;
        }

        .sidebar a:hover {
            background: #495057;
        }

        .sidebar .logout-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            cursor: pointer;
            width: 100%;
            padding: 10px;
            margin-top: 20px;
        }

        .content {
            margin-left: 250px;
            padding: 20px;
            width: 100%;
        }

        .top-bar {
            display: flex;
            justify-content: flex-end;
            padding: 10px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
        }

        .form-container {
            max-width: 600px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

         /* Botón cerrar sesión arriba */
         .top-bar {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 10px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
        }

        .top-bar button {
            background: none;
            border: none;
            color: #dc3545;
            font-size: 16px;
            cursor: pointer;
        }

        .top-bar button:hover {
            color: #c82333;
        }

        .table-container {
            border: 1px solid #ddd;
            border-radius: 0.45rem;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            background-color: white;
        }
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background-color: #90c0c6;
        }
        .table-header .table-title {
            font-family: Arial, sans-serif;
            font-size: 24px;
            font-weight: bold;
        }
        .table-header .search-container {
            display: flex;
            align-items: center;
        }
        .table-header .search-container input {
            border-radius: 0.25rem;
            border: 1px solid #ddd;
            padding: 0.5rem;
            margin-right: 0.5rem;
        }
        .table-custom {
            width: 100%;
        }
        .table-custom th, .table-custom td {
            text-align: center;
            vertical-align: middle;
            padding: 0.75rem;
        }
        .table-custom th {
            background-color: #f8f9fa;
            position: sticky;
            top: 0;
            z-index: 2;
        }
        .table-custom .table-footer {
            background-color: #f8f9fa;
            text-align: right;
            padding: 0.75rem;
        }


        .sidebar a.logo img {
    cursor: pointer;
    transition: none !important; /* Evita efectos de transición */
}

.sidebar a.logo:focus img, a.logo:active img {
    outline: none !important;
    box-shadow: none !important;
    filter: none !important;
}

.sidebar a.logo:hover,
.sidebar a.logo:hover img,
.sidebar a.logo:hover h4 {
    filter: none !important;
    color: inherit !important;
    background: transparent !important;
    box-shadow: none !important;
    text-decoration: none !important;
    opacity: 1 !important;
    transition: none !important;
}

/* Menú desplegable personalizado dentro de la sidebar */
.dropdown-container {
    position: relative;
    text-align: left;
    margin-bottom: 10px;
}

.main-title {
    background-color: #343a40;
    color: white;
    padding: 12px 16px;
    font-size: 18px;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.main-title:hover {
    background-color: #495057;
}

.dropdown-menu {
    display: none;
    position: absolute;
    left: 100%; /* Aparece al lado derecho de la sidebar */
    top: 0;
    background-color: #f8f9fa;
    border-radius: 6px;
    box-shadow: 0 0 8px rgba(0,0,0,0.15);
    min-width: 200px;
    z-index: 1000;
    flex-direction: column;
}

.dropdown-menu a {
    display: block;
    padding: 10px 16px;
    color: #343a40;
    text-decoration: none;
    font-size: 16px;
}

.dropdown-menu a:hover {
    background-color: #343a40;
    color: #f8f9fa;
}

/* Mostrar el menú cuando el mouse pasa por el contenedor */
.main-title:hover + .dropdown-menu {
    display: block;
}


    </style>
</head>
<body>
    <div class="sidebar">
        <a href="/Admin.html" class="logo"><img src="/assets/logo.png" alt="CardioCloud Logo"><h4></h4></a>       
        <div class="dropdown-container">
        <div class="main-title">Bancos de pacientes</div>
        <div class="dropdown-menu">
        <a href="Perfiles-pacientes.html">Tabla de usuarios (px)</a>
        <a href="Datosdepacientes.html">Tabla de pacientes</a>
        </div>
        <a href="/Registrodepaciente">Registro de pacientes</a>
        <a href="/Admin.html">Inicio</a>

</div>
 
        <button class="logout-btn" onclick="window.location.href='/logout'">
            <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
        </button>
    </div>

    <div class="content">
        <div class="top-bar">
            <button onclick="window.location.href='/logout'">
                <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
            </button>
        </div>
        <script>
document.addEventListener('DOMContentLoaded', () => {
    const title = document.querySelector('.main-title');
    const menu = document.querySelector('.dropdown-menu');

    let overMenu = false;

    title.addEventListener('mouseenter', () => {
        menu.style.display = 'block';
    });

    title.addEventListener('mouseleave', () => {
        setTimeout(() => {
            if (!overMenu) menu.style.display = 'none';
        }, 200);
    });

    menu.addEventListener('mouseenter', () => {
        overMenu = true;
    });

    menu.addEventListener('mouseleave', () => {
        overMenu = false;
        menu.style.display = 'none';
    });
});
</script>

        <div class="container mt-5">
            <h2>Registro del paciente</h2>
            <h5>Rellenar el formulario completo</h5>
            <form id="registro-paciente-form">
                <div class="form-group">
                    <label for="nombres">Nombre Completo</label>
                    <div class="form-row">
                        <div class="col">
                            <input type="text" class="form-control" id="nombres" name="nombres" placeholder="Nombres"
                                required>
                        </div>
                        <div class="col">
                            <input type="text" class="form-control" id="apellido_paterno" name="apellido_paterno"
                                placeholder="Apellido Paterno" required>
                        </div>
                        <div class="col">
                            <input type="text" class="form-control" id="apellido_materno" name="apellido_materno"
                                placeholder="Apellido Materno" required>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="fecha_nacimiento">Fecha de Nacimiento</label>
                    <input type="date" class="form-control" id="fecha_nacimiento" name="fecha_nacimiento" required>
                </div>
                <div class="form-group">
                    <label for="genero">Género</label>
                    <select class="form-control" id="genero" name="genero">
                        <option>Masculino</option>
                        <option>Femenino</option>
                        <option>Otro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="telefono">Teléfono</label>
                    <input type="tel" class="form-control" id="telefono" name="telefono">
                </div>
                <div class="form-group">
                    <label for="email">Correo Electrónico</label>
                    <input type="email" class="form-control" id="email" name="email" placeholder="ejemplo@dominio.com"
                        required>
                </div>
                    <div class="form-group">
                        <label for="peso">Peso</label>
                        <input type="number" min="10" max="600" id="peso" name="peso" placeholder="00"></input>
                        <label>kg</label> 
                    </div>
                    <div class="form-group">
                        <label for="estatura">Estatura</label>
                        <input type="number" min="0.50" max="2.99" step="0.01" id="estatura" name="estatura" placeholder="1.00"></input>
                        <label>m</label> 
                    </div>
                    <h4>Motivo de la consulta</h4>
                    <div class="form-group">
                        <label for="sintomas">Síntomas actuales</label>
                        <select class="form-control" id="sintomas" name="sintomas">
                            <option value="Dolor en el pecho">Dolor en el pecho</option>
                            <option value="Palpitaciones">Palpitaciones</option>
                            <option value="Fatiga">Fatiga</option>
                            <option value="Mareos y/o desmayos">Mareos y/o desmayos</option>
                            <option value="Hinchazón en piernas/tobillos">Hinchazón en piernas/tobillos</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fecha_sintomas">¿Cuándo comenzaron los sintomas?</label>
                        <input type="date" class="form-control" id="fecha_sintomas" name="fecha_sintomas" required>
                    </div>
                    <h4>Antecedentes médicos</h4>
                    <div class="form-group">
                        <label for="enfermedades">¿Tiene alguna enfermedad diagnosticada?</label>
                        <select class="form-control" id="enfermedades" name="enfermedades">
                            <option value="Hipertension">Hipertension</option>
                            <option value="Colesterol alto">Colesterol alto</option>
                            <option value="Trigliceridos alto">Trigliceridos alto</option>
                            <option value="Ninguna">Ninguna</option>
                        </select>
                    </div>
                    <h4>Antecedentes familiares</h4>
                    <div class="form-group">
                        <label for="antecedentes_familiares">¿Tiene familiares que hayan tenido un infarto?</label>
                        <select class="form-control" id="antecedentes_familiares" name="antecedentes_familiares">
                            <option value="Sí">Sí</option>
                            <option value="No">No</option>
                        </select>
                        <button type="submit" class="btn btn-outline-info">Registrar</button>
            
                    </div>
            </form>
        </div>
    </div>





  <!-- Modal para confirmación de éxito -->
    <div class="modal fade" id="successModal" tabindex="-1" role="dialog" aria-labelledby="successModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="successModalLabel">Registro Exitoso</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Paciente Registrado con éxito.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-dismiss="modal">Aceptar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Errores -->
    <div class="modal fade" id="errorModal" tabindex="-1" role="dialog" aria-labelledby="errorModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="errorModalLabel">Error</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Error al registrar el paciente. Por favor, intente nuevamente.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal para subir archivos -->
<div class="modal fade" id="uploadModal" tabindex="-1" role="dialog" aria-labelledby="uploadModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="uploadModalLabel">Subir Archivos para <span id="patientName"></span></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="uploadForm">
                    <div class="form-group">
                        <label for="fileType">Tipo de Archivo</label>
                        <select class="form-control" id="fileType">
                            <option value="electrocardiograma">Electrocardiograma</option>
                            <option value="fonocardiograma">Fonocardiograma</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fileInput">Seleccionar archivo</label>
                        <input type="file" class="form-control-file" id="fileInput">
                    </div>
                    <input type="hidden" id="patientId" value="">
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-danger" data-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-outline-info" onclick="submitFile()">Subir Archivo</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de éxito para subida de archivos -->
<div class="modal fade" id="uploadSuccessModal" tabindex="-1" role="dialog" aria-labelledby="uploadSuccessModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="uploadSuccessModalLabel">Subida Exitosa</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Archivo subido con éxito.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-success" data-dismiss="modal">Aceptar</button>
            </div>
        </div>
    </div>
</div>
 <!-- Modal de error -->
 <div id="errorModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="errorModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="errorModalLabel">Error</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p id="errorModalMessage"></p> <!-- Aquí se muestra el mensaje de error -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>


    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
    <script>
       $(document).ready(function () {
        const input = document.querySelector("#telefono");
        const iti = window.intlTelInput(input, {
            preferredCountries: ["mx", "us"],
            utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
        });

        $('#registro-paciente-form').submit(function (e) {
            e.preventDefault();  // Previene la recarga de la página por el envío del formulario.

            // Concatenar nombres
            var nombreCompleto = $('#nombres').val() + ' ' + $('#apellido_paterno').val() + ' ' + $('#apellido_materno').val();

            // Obtener el número de teléfono en formato internacional
            var telefono = iti.getNumber();

            // Ajustar la fecha de nacimiento para evitar problemas de zona horaria
            var fechaNacimiento = new Date($('#fecha_nacimiento').val());
            fechaNacimiento.setMinutes(fechaNacimiento.getMinutes() + fechaNacimiento.getTimezoneOffset())
            
            
            var datosPaciente = {
           nombre: nombreCompleto.trim(),
           fecha_nacimiento: fechaNacimiento.toISOString().slice(0,10), // Formato YYYY-MM-DD
           genero: $('#genero').val(),
           telefono: telefono,
           email: $('#email').val(),
           fecha_registro: new Date().toISOString().slice(0, 19).replace('T', ' '),
           peso: $('#peso').val() ? parseFloat($('#peso').val()) : null,  // Convertir a número o null
           estatura: $('#estatura').val() ? parseFloat($('#estatura').val()) : null,  // Convertir a número o null
           sintomas: $('#sintomas').val(),
           fecha_sintomas: $('#fecha_sintomas').val(),
           enfermedades: $('#enfermedades').val(),
           antecedentes_familiares: $('#antecedentes_familiares').val()
};
var formData = new FormData(); // Recoger todos los campos del formulario
            formData.append('datosPaciente', JSON.stringify(datosPaciente)); // Convertir objeto a JSON

            $.ajax({
                type: "POST",
                url: "/Registro",
                data: datosPaciente,
                success: function (response) {
                    console.log("Respuesta del servidor:", response);
                    $('#successModal .modal-body').text(response.message); // Actualiza el cuerpo del modal con el mensaje del servidor.
                    $('#successModal').modal('show');
                    
                    // Redirige a página de campo de datos del paciente
                     setTimeout(function () {
                     window.location.href = "/Datosdepacientes"; //Redirigir a la página de datos del paciente. 
                     }, 2000);  // Espera 2 segundos antes de redirigir para que el usuario vea el mensaje de éxito.
                    // Limpiar el formulario si el registro fue exitoso
                    $('#registro-paciente-form')[0].reset();
                    iti.setNumber(''); // Limpiar el campo de teléfono
                    
                },
                error: function (xhr) {
                    console.log("Error del servidor:", xhr.responseJSON);
                    $('#errorModal .modal-body').text(xhr.responseJSON.error);
                    $('#errorModal').modal('show');
                }
            });
        });
    });
    </script>

</body>

</html> 

